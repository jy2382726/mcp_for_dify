# ALIGNMENT_text_splitter_verification

## 1. 原始需求 (Original Requirements)

基于最近的开发上下文和用户反馈，本次任务的核心目标是对 `TextSplitterService` 的最新重构进行全面的验证和验收。具体需求包括：

1.  **验证动态分隔符支持**：确保 `split` 方法能正确处理用户传入的 `parent_separator` 和 `sub_separator`，并在最终输出中正确应用。
2.  **验证原子内容保护**：
    *   确保图片解析内容（`【图片主题：...】`）不被意外切分。
    *   确保 Markdown 表格不被意外切分。
    *   **关键点**：验证原子内容前后是否正确添加了分隔符（强制换行/子块分隔符）。
3.  **验证标题合并逻辑**：确保两个距离很近（<200 字符）的标题块被合并，而不是被切碎。
4.  **验证 HTML 表格转换**：确保 HTML 表格能正确转换为 Markdown 格式。
5.  **验证超大内容处理**：
    *   超大图片描述应按段落切分。
    *   超大表格应按行切分。

## 2. 边界确认 (Boundary Confirmation)

*   **范围**：仅限于 `TextSplitterService` 的 PDF 模式 (`_split_pdf_text`) 及其相关辅助方法。
*   **输入**：使用 `demo/demo.txt` 以及构造的测试用例（包含 HTML 表格、Markdown 表格、不同格式的图片描述）。
*   **输出**：验证切分后的文本结构、分隔符位置、内容完整性。
*   **不包含**：不涉及 OCR 识别、PDF 解析本身的逻辑（假设输入已经是文本）。

## 3. 需求理解 (Understanding)

*   **当前状态**：代码已修改，但在 `demo.txt` 上的最终效果需要确认，特别是原子内容的“前后分隔符”问题。
*   **核心挑战**：
    *   确保正则匹配覆盖各种非标准格式（如表格前后的空格）。
    *   确保 Token 替换机制在还原时不会丢失分隔符。
    *   验证逻辑需要覆盖多种 `block_size` 组合（默认、极小、极大）。

## 4. 疑问澄清 (Questions/Clarifications)

1.  **HTML 表格转换**：代码中已存在 `_convert_html_tables_to_markdown`，是否需要针对特定复杂的 HTML 结构进行额外测试？
    *   *假设*：目前仅需验证基础的 `<table>` 结构转换。
2.  **验证方式**：是否需要生成可视化的报告，或者仅需通过脚本输出 Pass/Fail？
    *   *假设*：生成包含切分结果的日志文件供人工审查，同时脚本输出断言结果。

## 5. 下一步计划

*   设计详细的验证脚本 `verify_splitter.py`。
*   执行验证并调整代码（如果发现 Bug）。
